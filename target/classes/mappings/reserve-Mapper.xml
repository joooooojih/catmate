<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="reserve">

  <select id="getPet_sitter_house" resultType="Pet_sitter_house">
    <![CDATA[
      SELECT * FROM pet_sitter_house WHERE idx = #{idx}
    ]]>
  </select>
  
  <select id="getPet_sitter_houseList" resultType="Pet_sitter_house">
    <![CDATA[
      SELECT * FROM pet_sitter_house
      ORDER BY idx DESC
    ]]>
  </select>
  
  <select id="getPet_sitter_house_not" resultType="Pet_sitter_house">
    SELECT * FROM pet_sitter_house
    WHERE
    idx NOT IN
    <foreach collection="list" item="reservationDto" index="index" separator="," open="(" close=")">
      #{reservationDto.idx}
    </foreach>
    ORDER BY idx DESC
  </select>
  
  <select id="getPet_sitter_house_search" resultType="Pet_sitter_house">
      SELECT * FROM pet_sitter_house
      WHERE 
      idx = #{idx}
      AND sregister = 'yes'
      <if test="care_space != null and care_space == '아파트'">
        AND care_space = #{care_space}
      </if>
      <if test="pick_up != null and pick_up == 'yes'">
        AND pick_up = #{pick_up}
      </if>
      <if test="yard != null and yard == '있습니다.'">
        AND yard = #{yard}
      </if>
      <if test="other_animal != null and other_animal == '다른 동물은 없습니다.'">
        AND other_animal = #{other_animal}
      </if>
      <if test="patient_dog != null and patient_dog == 'yes'">
        AND patient_dog = #{patient_dog}
      </if>
      <if test="license != null and license == 'yes'">
        AND license = #{license}
      </if>
      <if test="outdoor_bowels != null and outdoor_bowels == 'yes'">
        AND outdoor_bowels = #{outdoor_bowels}
      </if>
      <if test="homemade_snacks != null and homemade_snacks == 'yes'">
        AND homemade_snacks = #{homemade_snacks}
      </if>
      <if test="first_aid != null and first_aid == 'yes'">
        AND first_aid = #{first_aid}
      </if>
      <if test="medication_possible != null and medication_possible == 'yes'">
        AND medication_possible = #{medication_possible}
      </if>
      <if test="care_age != '모든연령' and care_age != null">
        <![CDATA[
          AND care_age LIKE CONCAT('%', #{care_age}, '%')
        ]]>
      </if>
      <if test="care_size != 0">
        <![CDATA[
          AND care_size >= #{care_size}
        ]]>
      </if>
      <if test="area != '' and area != null and area != '전체'">
        <![CDATA[
          AND house_address LIKE CONCAT(#{area}, '%')
        ]]>
      </if>
  </select>
  
  <insert id="insertReservation">
    <![CDATA[
      INSERT INTO reservation (idx, user_email, start_day, end_day, how_many)
      VALUES (#{idx}, #{user_email}, #{start_day}, #{end_day}, #{how_many})
    ]]>
  </insert>
  
  <select id="getReservation" resultType="reservation">
    <![CDATA[
      SELECT * FROM reservation 
      WHERE
      idx = #{idx}
      ORDER BY
      start_day asc
    ]]>
  </select>
  
  <select id="getReservationList" resultType="reservation">
    <![CDATA[
      SELECT * FROM reservation
    ]]>
  </select>
  
  <select id="getRoom_photo" resultType="Room_photo">
    <![CDATA[
      SELECT * FROM room_photo WHERE idx = #{idx}
    ]]>
  </select>
  
  <select id="getAreaAllCount" resultType="integer">
    <![CDATA[
      SELECT COUNT(*) FROM pet_sitter_house WHERE sregister = 'yes'
    ]]>
  </select>
  
  <select id="getAreaCount" resultType="integer">
    <![CDATA[
      SELECT COUNT(*) FROM pet_sitter_house 
      WHERE house_address LIKE CONCAT(#{area}, '%')
      AND sregister = 'yes'
    ]]>
  </select>
  
  <select id="getPetCount" resultType="integer">
    <![CDATA[
      SELECT COUNT(*) FROM pet_profile
      WHERE
      user_email=#{user_email}
    ]]>
  </select>
</mapper>
